"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=exports.removeElements=exports.removeElement=exports.removeDriver=exports.addElements=exports.addElement=exports.addDriver=exports.laxInstance=void 0;var inOutMap=function(e){return["elInY+elHeight","elCenterY-"+(e=void 0===e?30:e),"elCenterY","elCenterY+"+e,"elOutY-elHeight"]},laxPresets={fadeInOut:function(e,t){return void 0===t&&(t=0),{opacity:[inOutMap(e=void 0===e?30:e),[t,1,1,1,t]]}},fadeIn:function(e,t){return{opacity:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?0:t,1]]}},fadeOut:function(e,t){return{opacity:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[1,t=void 0===t?0:t]]}},blurInOut:function(e,t){return void 0===t&&(t=20),{blur:[inOutMap(e=void 0===e?100:e),[t,0,0,0,t]]}},blurIn:function(e,t){return{blur:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?20:t,0]]}},blurOut:function(e,t){return{opacity:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[0,t=void 0===t?20:t]]}},scaleInOut:function(e,t){return void 0===t&&(t=.6),{scale:[inOutMap(e=void 0===e?100:e),[t,1,1,1,t]]}},scaleIn:function(e,t){return{scale:[["elInY+elHeight",e=void 0===e?"elCenterY":e],[t=void 0===t?.6:t,1]]}},scaleOut:function(e,t){return{scale:[[e=void 0===e?"elCenterY":e,"elOutY-elHeight"],[1,t=void 0===t?.6:t]]}},slideX:function(e,t){return{translateX:[["elInY",e=void 0===e?0:e],[0,t=void 0===t?500:t]]}},slideY:function(e,t){return{translateY:[["elInY",e=void 0===e?0:e],[0,t=void 0===t?500:t]]}},spin:function(e,t){return{rotate:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},flipX:function(e,t){return{rotateX:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},flipY:function(e,t){return{rotateY:[[0,e=void 0===e?1e3:e],[0,t=void 0===t?360:t],{modValue:e}]}},jiggle:function(e,t){return{skewX:[[0,+(e=void 0===e?50:e),2*e,3*e,4*e],[0,t=void 0===t?40:t,0,-t,0],{modValue:4*e}]}},seesaw:function(e,t){return{skewY:[[0,+(e=void 0===e?50:e),2*e,3*e,4*e],[0,t=void 0===t?40:t,0,-t,0],{modValue:4*e}]}},zigzag:function(e,t){return{translateX:[[0,+(e=void 0===e?100:e),2*e,3*e,4*e],[0,t=void 0===t?100:t,0,-t,0],{modValue:4*e}]}},hueRotate:function(e,t){return{"hue-rotate":[[0,e=void 0===e?600:e],[0,t=void 0===t?360:t],{modValue:e}]}}},transformKeys=["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"],filterKeys=["blur","hue-rotate","brightness"],translate3dKeys=["translateX","translateY","translateZ"],pxUnits=["perspective","border-radius","blur","translateX","translateY","translateZ"],degUnits=["hue-rotate","rotate","rotateX","rotateY","skew","skewX","skewY"];function getArrayValues(e,t){if(Array.isArray(e))return e;for(var n=Object.keys(e).map(function(e){return parseInt(e)}).sort(function(e,t){return t<e?1:-1}),r=n[n.length-1],a=0;a<n.length;a++){var i=n[a];if(t<i){r=i;break}}return e[r]}function lerp(e,t,n){return e*(1-n)+t*n}function invlerp(e,t,n){return(n-e)/(t-e)}function interpolate(e,t,n,r){var a=0;if(e.forEach(function(e){e<n&&a++}),a<=0)return t[0];if(a>=e.length)return t[e.length-1];var i=a-1,e=invlerp(e[i],e[a],n);return r&&(e=r(e)),lerp(t[i],t[a],e)}var easings={easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},easeOutBounce:function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInBounce:function(e){return 1-easings.easeOutBounce(1-e)},easeOutBack:function(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)},easeInBack:function(e){return 2.70158*e*e*e-1.70158*e*e}};function flattenStyles(r){var a={transform:"",filter:""},i={translateX:1e-5,translateY:1e-5,translateZ:1e-5};return Object.keys(r).forEach(function(e){var t=r[e],n=pxUnits.includes(e)?"px":degUnits.includes(e)?"deg":"";translate3dKeys.includes(e)?i[e]=t:transformKeys.includes(e)?a.transform+=e+"("+t+n+") ":filterKeys.includes(e)?a.filter+=e+"("+t+n+") ":a[e]=t+n+" "}),a.transform="translate3d("+i.translateX+"px, "+i.translateY+"px, "+i.translateZ+"px) "+a.transform,a}function getScrollPosition(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||""),n=e?window.pageXOffset:(t?document.documentElement:document.body).scrollLeft;return[e?window.pageYOffset:(t?document.documentElement:document.body).scrollTop,n]}function parseValue(e,t,n){var r=t.width,a=t.height,i=t.x,o=t.y;if("number"==typeof e)return e;var s=document.body.scrollHeight,l=document.body.scrollWidth,u=window.innerWidth,d=window.innerHeight,c=getScrollPosition(),t=c[0],i=i+c[1],c=i+r,o=o+t,t=o+a;return Function("return "+e.replace(/screenWidth/g,u).replace(/screenHeight/g,d).replace(/pageHeight/g,s).replace(/pageWidth/g,l).replace(/elWidth/g,r).replace(/elHeight/g,a).replace(/elInY/g,o-d).replace(/elOutY/g,t).replace(/elCenterY/g,o+a/2-d/2).replace(/elInX/g,i-u).replace(/elOutX/g,c).replace(/elCenterX/g,i+r/2-u/2).replace(/index/g,n))()}var LaxDriver=function(e,t,n){var r=this;void 0===n&&(n={}),this.name="",this.lastValue=0,this.frameStep=1,this.m1=0,this.m2=0,this.inertia=0,this.inertiaEnabled=!1,this.getValue=function(e){var t=r.lastValue;return e%r.frameStep==0&&(t=r.getValueFn(e)),r.inertiaEnabled&&(e=t-r.lastValue,r.m1=.8*r.m1+e*(1-.8),r.m2=.8*r.m2+r.m1*(1-.8),r.inertia=Math.round(5e3*r.m2)/15e3),r.lastValue=t,[r.lastValue,r.inertia]},this.name=e,this.getValueFn=t,Object.keys(n).forEach(function(e){r[e]=n[e]}),this.lastValue=this.getValueFn(0)},LaxElement=function(e,t,n,r,a,i){var E=this;void 0===a&&(a=0),void 0===i&&(i={}),this.styles={},this.selector="",this.groupIndex=0,this.update=function(e,t){var n,r=E.transforms,a={};for(n in r){var i=r[n];e[n]||console.error("No lax driver with name: ",n);var o,s=e[n],l=s[0],u=s[1];for(o in i){var d,c=i[o],f=c[0],m=c[1],v=c[2],p=void 0===v?{}:v,h=p.modValue,g=p.frameStep,x=void 0===g?1:g,w=p.easing,c=p.inertia,v=p.inertiaMode,g=p.cssFn,p=p.cssUnit,p=void 0===p?"":p,w=easings[w];t%x==0&&(w=interpolate(f,m,h?l%h:l,w),c&&(d=u*c,w+=d="absolute"===v?Math.abs(d):d),d="px"==(p||pxUnits.includes(o)?"px":degUnits.includes(o)?"deg":"")?0:3,d=w.toFixed(d),a[o]=g?g(d,E.domElement):d+p)}}E.applyStyles(a),E.onUpdate&&E.onUpdate(e,E.domElement)},this.calculateTransforms=function(){E.transforms={};var e,s=E.laxInstance.windowWidth;for(e in E.transformsData)!function(e){var t,i=E.transformsData[e],o={},n=i.presets;for(t in(void 0===n?[]:n).forEach(function(e){var t,n=e.split(":"),r=n[0],a=n[1],e=n[2],n=window.lax.presets[r];n?(t=n(a,e),Object.keys(t).forEach(function(e){i[e]=t[e]})):console.error("Lax preset cannot be found with name: ",r)}),delete i.presets,i)!function(e){var t=i[e],n=void 0===(r=t[0])?[-1e9,1e9]:r,r=void 0===(r=t[1])?[-1e9,1e9]:r,t=void 0===(t=t[2])?{}:t,a=E.domElement.getBoundingClientRect(),n=getArrayValues(n,s).map(function(e){return parseValue(e,a,E.groupIndex)}),r=getArrayValues(r,s).map(function(e){return parseValue(e,a,E.groupIndex)});o[e]=[n,r,t]}(t);E.transforms[e]=o}(e)},this.applyStyles=function(e){var t=flattenStyles(e);Object.keys(t).forEach(function(e){E.domElement.style.setProperty(e,t[e])})},this.selector=e,this.laxInstance=t,this.domElement=n,this.transformsData=r,this.groupIndex=a;var o=void 0===(a=i.style)?{}:a,i=i.onUpdate;Object.keys(o).forEach(function(e){n.style.setProperty(e,o[e])}),i&&(this.onUpdate=i),this.calculateTransforms()},Lax=function(){var i=this;this.drivers=[],this.elements=[],this.frame=0,this.debug=!1,this.windowWidth=0,this.windowHeight=0,this.presets=laxPresets,this.debugData={frameLengths:[]},this.init=function(){i.findAndAddElements(),window.requestAnimationFrame(i.onAnimationFrame),i.windowWidth=document.body.clientWidth,i.windowHeight=document.body.clientHeight,window.onresize=i.onWindowResize},this.onWindowResize=function(){document.body.clientWidth===i.windowWidth&&document.body.clientHeight===i.windowHeight||(i.windowWidth=document.body.clientWidth,i.windowHeight=document.body.clientHeight,i.elements.forEach(function(e){return e.calculateTransforms()}))},this.onAnimationFrame=function(e){i.debug&&(i.debugData.frameStart=Date.now());var t,n={};i.drivers.forEach(function(e){n[e.name]=e.getValue(i.frame)}),i.elements.forEach(function(e){e.update(n,i.frame)}),i.debug&&i.debugData.frameLengths.push(Date.now()-i.debugData.frameStart),i.frame%60==0&&i.debug&&(t=Math.ceil(i.debugData.frameLengths.reduce(function(e,t){return e+t},0)/60),console.log("Average frame calculation time: "+t+"ms"),i.debugData.frameLengths=[]),i.frame++,window.requestAnimationFrame(i.onAnimationFrame)},this.addDriver=function(e,t,n){void 0===n&&(n={}),i.drivers.push(new LaxDriver(e,t,n))},this.removeDriver=function(t){i.drivers=i.drivers.filter(function(e){return e.name!==t})},this.findAndAddElements=function(){i.elements=[],document.querySelectorAll(".lax").forEach(function(e){var t=[];e.classList.forEach(function(e){e.includes("lax_preset")&&(e=e.replace("lax_preset_",""),t.push(e))});var n=((n={}).scrollY={presets:t},n);i.elements.push(new LaxElement(".lax",i,e,n,0))})},this.addElements=function(n,r,a){document.querySelectorAll(n).forEach(function(e,t){i.elements.push(new LaxElement(n,i,e,r,t,a))})},this.removeElements=function(t){i.elements=i.elements.filter(function(e){return e.selector!==t})},this.addElement=function(e,t,n){i.elements.push(new LaxElement("",i,e,t,0,n))},this.removeElement=function(t){i.elements=i.elements.filter(function(e){return e.domElement!==t})}};exports.laxInstance=new Lax;var lax={addElements:exports.laxInstance.addElements,removeElements:exports.laxInstance.removeElements,removeElement:exports.laxInstance.removeElement,addElement:exports.laxInstance.addElement,init:exports.laxInstance.init,addDriver:exports.laxInstance.addDriver,removeDriver:exports.laxInstance.removeDriver};"undefined"!=typeof module&&void 0!==module.exports?module.exports=lax:window?window.lax=lax:global?global.lax=lax:globalThis&&(globalThis.lax=lax),exports.default=lax,exports.addDriver=lax.addDriver,exports.addElement=lax.addElement,exports.addElements=lax.addElements,exports.removeDriver=lax.removeDriver,exports.removeElement=lax.removeElement,exports.removeElements=lax.removeElements,exports.init=lax.init;